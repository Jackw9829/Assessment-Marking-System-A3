# Interim Transcript Feature

## EduConnect Assessment Marking System (AMS)

**Document Version:** 1.0  
**Date:** 31 January 2026  
**Author:** Development Team  
**Status:** Design Complete

---

## 1. Feature Overview

The Interim Transcript feature enables authenticated students to generate and download an official interim academic transcript containing only their released/published grades. This document provides a snapshot of the student's current academic standing and is clearly marked as "Interim" to distinguish it from final official transcripts issued by the institution's registrar. Strict access controls ensure students can only generate transcripts for their own academic records.

---

## 2. Refined User Story

### Primary User Story (Student)

> **As an** authenticated student enrolled in the EduConnect Assessment Marking System,  
> **I want to** generate and download an interim academic transcript containing my released grades,  
> **So that I** can provide evidence of my current academic progress to employers, scholarship committees, or other institutions while my studies are ongoing.

### Supporting User Stories

> **As a** student requiring proof of academic progress,  
> **I want** the transcript to display only grades that have been officially released by instructors,  
> **So that I** receive accurate information and am not exposed to preliminary or unverified results.

> **As a** student concerned about data privacy,  
> **I want** assurance that only I can access and generate my transcript,  
> **So that** my academic records remain confidential and secure.

> **As a** student submitting the transcript externally,  
> **I want** the document to be clearly labelled as "Interim Transcript",  
> **So that** recipients understand this is not a final certified document from the registrar.

---

## 3. Acceptance Criteria

### AC-1: Authentication Required
- **Given** an unauthenticated user attempts to access the transcript generation page
- **When** they navigate to the transcript feature or attempt to generate a document
- **Then** they are redirected to the authentication page with the return URL preserved
- **And** only users with valid authenticated sessions can access transcript functionality
- **And** session expiry during generation results in appropriate error handling

### AC-2: Strict Access Control (Own Transcript Only)
- **Given** an authenticated student attempts to generate a transcript
- **When** the system processes the request
- **Then** the student can only generate a transcript for their own student ID
- **And** any attempt to access another student's records is rejected with an "Access Denied" error
- **And** API endpoints validate that `auth.uid()` matches the requested student ID
- **And** database Row Level Security (RLS) policies enforce data isolation
- **And** all access attempts are logged for audit purposes

### AC-3: Released Grades Only
- **Given** a student has grades recorded in the system
- **When** the transcript is generated
- **Then** only grades where `is_released = TRUE` are included
- **And** grades pending release, under review, or not yet finalised are excluded
- **And** the system queries the `grades` table with the release status filter applied
- **And** the transcript reflects the most current released grades at generation time

### AC-4: Student Details Display
- **Given** a student generates their interim transcript
- **When** the document is rendered
- **Then** the following student details are displayed in the header:
  - Full legal name (from profile)
  - Student email address
  - Unique student identifier
  - Date of transcript generation
- **And** student details are retrieved from the authenticated user's profile
- **And** no editable fields are presented to prevent tampering

### AC-5: Course List with Grades
- **Given** a student has completed assessments with released grades
- **When** the transcript is generated
- **Then** the document displays a structured list containing:
  - Course code and title
  - Assessment title and type
  - Score achieved and total marks possible
  - Percentage and grade label (HD/D/CR/P/F)
  - Date grade was released
- **And** courses are grouped and sorted alphabetically by course code
- **And** assessments within each course are listed chronologically
- **And** a summary section shows overall statistics (total assessments, average percentage)

### AC-6: Interim Labelling
- **Given** a student generates an academic transcript
- **When** the document is rendered
- **Then** the document is prominently labelled "INTERIM TRANSCRIPT" in:
  - The document header (large, bold text)
  - A watermark across each page
  - The document footer
- **And** a disclaimer statement is included:
  > "This is an interim transcript generated by EduConnect AMS. It reflects only grades that have been released as of the generation date. This document is not an official transcript from the university registrar and should not be used for purposes requiring certified academic records."
- **And** the interim status is unambiguous to prevent misrepresentation

### AC-7: PDF Download Functionality
- **Given** a student requests to download their transcript
- **When** they click the "Download PDF" button
- **Then** a PDF document is generated containing all transcript information
- **And** the PDF follows a consistent, professional template with:
  - Institution branding/logo placeholder
  - Proper page formatting (A4 size, appropriate margins)
  - Readable font sizing and spacing
  - Page numbers if multiple pages
- **And** the filename follows the format: `Interim_Transcript_[StudentName]_[Date].pdf`
- **And** the download initiates automatically upon generation

### AC-8: Transcript Generation Timestamp
- **Given** a transcript is generated
- **When** the document is created
- **Then** the exact date and time of generation is recorded and displayed
- **And** the timestamp uses the format: "Generated on: DD Month YYYY at HH:MM (Timezone)"
- **And** the generation event is logged in the audit trail
- **And** repeated generation produces documents with updated timestamps

### AC-9: Empty State Handling
- **Given** a student has no released grades in the system
- **When** they attempt to generate a transcript
- **Then** a clear message is displayed: "No released grades available for transcript generation"
- **And** the PDF download option is disabled or hidden
- **And** guidance is provided: "Grades will appear here once your instructors release them"
- **And** the student is not presented with an empty or meaningless document

### AC-10: Audit Trail and Security Logging
- **Given** transcript functionality is accessed
- **When** any of the following events occur:
  - Transcript page accessed
  - Transcript generated
  - PDF downloaded
  - Access denied (attempted unauthorised access)
- **Then** the event is logged with:
  - User ID
  - Timestamp
  - Action type
  - IP address (where available)
  - Success/failure status
- **And** logs are retained for compliance and security review
- **And** logs are immutable and cannot be modified by students

---

## 4. Technical Requirements

### Database Schema

```sql
-- Transcript generation audit log
CREATE TABLE IF NOT EXISTS transcript_audit_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    student_id UUID NOT NULL REFERENCES profiles(id),
    action VARCHAR(50) NOT NULL, -- 'viewed', 'generated', 'downloaded'
    ip_address INET,
    user_agent TEXT,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS: Students can only see their own audit logs (if exposed)
ALTER TABLE transcript_audit_log ENABLE ROW LEVEL SECURITY;

CREATE POLICY "students_own_transcript_logs" ON transcript_audit_log
    FOR SELECT USING (student_id = auth.uid());

-- Function to get transcript data (released grades only)
CREATE OR REPLACE FUNCTION get_student_transcript_data(p_student_id UUID)
RETURNS TABLE (
    course_id UUID,
    course_code TEXT,
    course_title TEXT,
    assessment_id UUID,
    assessment_title TEXT,
    assessment_type TEXT,
    score INTEGER,
    total_marks INTEGER,
    percentage NUMERIC,
    grade_label TEXT,
    released_at TIMESTAMPTZ
)
SECURITY DEFINER
AS $$
BEGIN
    -- Verify requesting user is the student
    IF auth.uid() != p_student_id THEN
        RAISE EXCEPTION 'Access denied: You can only view your own transcript';
    END IF;

    RETURN QUERY
    SELECT 
        c.id AS course_id,
        c.code AS course_code,
        c.title AS course_title,
        a.id AS assessment_id,
        a.title AS assessment_title,
        a.assessment_type::TEXT,
        g.score,
        g.total_marks,
        ROUND((g.score::NUMERIC / g.total_marks) * 100, 2) AS percentage,
        CASE 
            WHEN (g.score::NUMERIC / g.total_marks) * 100 >= 85 THEN 'HD'
            WHEN (g.score::NUMERIC / g.total_marks) * 100 >= 75 THEN 'D'
            WHEN (g.score::NUMERIC / g.total_marks) * 100 >= 65 THEN 'CR'
            WHEN (g.score::NUMERIC / g.total_marks) * 100 >= 50 THEN 'P'
            ELSE 'F'
        END AS grade_label,
        g.released_at
    FROM grades g
    JOIN submissions s ON g.submission_id = s.id
    JOIN assessments a ON s.assessment_id = a.id
    JOIN courses c ON a.course_id = c.id
    WHERE s.student_id = p_student_id
      AND g.is_released = TRUE
      AND s.is_latest = TRUE
    ORDER BY c.code, g.released_at;
END;
$$ LANGUAGE plpgsql;
```

### RLS Policy Enforcement

```sql
-- Ensure grades RLS restricts to released grades for students
CREATE POLICY "students_view_released_grades_only" ON grades
    FOR SELECT
    USING (
        is_released = TRUE
        AND EXISTS (
            SELECT 1 FROM submissions 
            WHERE submissions.id = grades.submission_id 
            AND submissions.student_id = auth.uid()
        )
    );
```

---

## 5. UI Components

### Transcript Preview Panel
- Student information header
- Course-by-course grade breakdown
- Summary statistics section
- "Download PDF" button
- Generation timestamp display

### PDF Template Structure
```
+------------------------------------------+
|        [Institution Logo/Name]           |
|                                          |
|        INTERIM TRANSCRIPT                |
|        ==================                |
|                                          |
| Student: [Full Name]                     |
| Email: [Email Address]                   |
| Student ID: [UUID/ID]                    |
| Generated: [Date and Time]               |
|                                          |
| ---------------------------------------- |
|                                          |
| COURSE: [CODE] - [Title]                 |
| ---------------------------------------- |
| Assessment    | Type | Score | % | Grade |
| ------------- | ---- | ----- | - | ----- |
| [Title]       | [T]  | X/Y   | Z | HD    |
|                                          |
| [Repeat for each course]                 |
|                                          |
| ---------------------------------------- |
| SUMMARY                                  |
| Total Assessments: X                     |
| Overall Average: Y%                      |
| ---------------------------------------- |
|                                          |
| DISCLAIMER:                              |
| This is an interim transcript...         |
|                                          |
|        [INTERIM TRANSCRIPT watermark]    |
+------------------------------------------+
```

---

## 6. Security Considerations

| Aspect | Implementation |
|--------|----------------|
| **Authentication** | Valid session required; redirect to login if expired |
| **Authorisation** | RLS + function-level checks ensure own-data-only access |
| **Data Integrity** | Only `is_released = TRUE` grades included |
| **Audit Trail** | All transcript actions logged with timestamps |
| **Document Security** | Watermark and disclaimer prevent misuse |
| **API Security** | Server-side validation of student ID against `auth.uid()` |

---

## 7. Integration Points

| System | Integration |
|--------|-------------|
| **Grades Dashboard** | Uses same released grades data source |
| **Authentication** | Leverages existing Supabase auth context |
| **Audit System** | Extends existing audit logging patterns |
| **PDF Generation** | Client-side generation or Edge Function |

---

## 8. Success Metrics

| Metric | Target |
|--------|--------|
| Transcript generation success rate | 99.9% |
| PDF generation time | < 3 seconds |
| Zero unauthorised access incidents | 100% |
| Student satisfaction with transcript clarity | > 90% |
| Audit log completeness | 100% of actions logged |

---

## 9. Out of Scope

- Official/certified transcript generation (registrar function)
- Transcript verification by external parties
- Historical transcript versions
- Transcript sharing/email functionality
- Transcript request workflow (for official documents)
- GPA/WAM calculation (institution-specific)

---

## 10. Compliance Notes

- Transcripts contain personal academic information subject to privacy regulations
- Interim status clearly marked to prevent fraudulent use
- Audit trails support institutional compliance requirements
- Data access restricted to authenticated record owner only

---

*Document approved for implementation.*
